const lgaWardData = {
    "AGEGE LGA": ["Agege Ward 1", "Agege Ward 2", "Agege Ward 3", "Agege Ward 4", "Agege Ward 5", "Agege Ward 6", "Agege Ward 7", "Agege Ward 8", "Agege Ward 9", "Agege Ward 10"],
    "AJEROMI-IFELODUN LGA": ["Ajeromi Ward 1", "Ajeromi Ward 2", "Ajeromi Ward 3", "Ajeromi Ward 4", "Ajeromi Ward 5", "Ajeromi Ward 6", "Ajeromi Ward 7", "Ajeromi Ward 8", "Ajeromi Ward 9", "Ajeromi Ward 10", "Ajeromi Ward 11"],
    "ALIMOSHO LGA": ["Alimosho Ward 1", "Alimosho Ward 2", "Alimosho Ward 3", "Alimosho Ward 4", "Alimosho Ward 5", "Alimosho Ward 6", "Alimosho Ward 7", "Alimosho Ward 8", "Alimosho Ward 9", "Alimosho Ward 10", "Alimosho Ward 11", "Alimosho Ward 12", "Alimosho Ward 13"],
    "AMUWO-ODOFIN LGA": ["Amuwo-Odofin Ward 1", "Amuwo-Odofin Ward 2", "Amuwo-Odofin Ward 3", "Amuwo-Odofin Ward 4", "Amuwo-Odofin Ward 5", "Amuwo-Odofin Ward 6", "Amuwo-Odofin Ward 7", "Amuwo-Odofin Ward 8", "Amuwo-Odofin Ward 9", "Amuwo-Odofin Ward 10"],
    "APAPA LGA": ["Apapa Ward 1", "Apapa Ward 2", "Apapa Ward 3", "Apapa Ward 4", "Apapa Ward 5"],
    "BADAGRY LGA": ["Badagry Ward 1", "Badagry Ward 2", "Badagry Ward 3", "Badagry Ward 4", "Badagry Ward 5", "Badagry Ward 6", "Badagry Ward 7", "Badagry Ward 8", "Badagry Ward 9", "Badagry Ward 10"],
    "EPE LGA": ["Epe Ward 1", "Epe Ward 2", "Epe Ward 3", "Epe Ward 4", "Epe Ward 5", "Epe Ward 6", "Epe Ward 7", "Epe Ward 8", "Epe Ward 9", "Epe Ward 10"],
    "ETI-OSA LGA": ["Eti-Osa Ward 1", "Eti-Osa Ward 2", "Eti-Osa Ward 3", "Eti-Osa Ward 4", "Eti-Osa Ward 5", "Eti-Osa Ward 6", "Eti-Osa Ward 7", "Eti-Osa Ward 8", "Eti-Osa Ward 9", "Eti-Osa Ward 10"],
    "IBEJU-LEKKI LGA": ["Ibeju-Lekki Ward 1", "Ibeju-Lekki Ward 2", "Ibeju-Lekki Ward 3", "Ibeju-Lekki Ward 4", "Ibeju-Lekki Ward 5", "Ibeju-Lekki Ward 6", "Ibeju-Lekki Ward 7", "Ibeju-Lekki Ward 8", "Ibeju-Lekki Ward 9", "Ibeju-Lekki Ward 10"],
    "IFAKO-IJAYE LGA": ["Ifako-Ijaye Ward 1", "Ifako-Ijaye Ward 2", "Ifako-Ijaye Ward 3", "Ifako-Ijaye Ward 4", "Ifako-Ijaye Ward 5", "Ifako-Ijaye Ward 6", "Ifako-Ijaye Ward 7", "Ifako-Ijaye Ward 8", "Ifako-Ijaye Ward 9", "Ifako-Ijaye Ward 10"],
    "IKEJA LGA": ["Ikeja Ward 1", "Ikeja Ward 2", "Ikeja Ward 3", "Ikeja Ward 4", "Ikeja Ward 5", "Ikeja Ward 6", "Ikeja Ward 7", "Ikeja Ward 8", "Ikeja Ward 9", "Ikeja Ward 10"],
    "IKORODU LGA": ["Ikorodu Ward 1", "Ikorodu Ward 2", "Ikorodu Ward 3", "Ikorodu Ward 4", "Ikorodu Ward 5", "Ikorodu Ward 6", "Ikorodu Ward 7", "Ikorodu Ward 8", "Ikorodu Ward 9", "Ikorodu Ward 10", "Ikorodu Ward 11"],
    "KOSOFE LGA": ["Kosofe Ward 1", "Kosofe Ward 2", "Kosofe Ward 3", "Kosofe Ward 4", "Kosofe Ward 5", "Kosofe Ward 6", "Kosofe Ward 7", "Kosofe Ward 8", "Kosofe Ward 9", "Kosofe Ward 10", "Kosofe Ward 11"],
    "LAGOS ISLAND LGA": ["Lagos Island Ward 1", "Lagos Island Ward 2", "Lagos Island Ward 3", "Lagos Island Ward 4", "Lagos Island Ward 5"],
    "LAGOS MAINLAND LGA": ["Lagos Mainland Ward 1", "Lagos Mainland Ward 2", "Lagos Mainland Ward 3", "Lagos Mainland Ward 4", "Lagos Mainland Ward 5", "Lagos Mainland Ward 6", "Lagos Mainland Ward 7", "Lagos Mainland Ward 8", "Lagos Mainland Ward 9", "Lagos Mainland Ward 10", "Lagos Mainland Ward 11", "Lagos Mainland Ward 12"],
    "MUSHIN LGA": ["Mushin Ward 1", "Mushin Ward 2", "Mushin Ward 3", "Mushin Ward 4", "Mushin Ward 5", "Mushin Ward 6", "Mushin Ward 7", "Mushin Ward 8", "Mushin Ward 9", "Mushin Ward 10", "Mushin Ward 11"],
    "OJO LGA": ["Ojo Ward 1", "Ojo Ward 2", "Ojo Ward 3", "Ojo Ward 4", "Ojo Ward 5", "Ojo Ward 6", "Ojo Ward 7", "Ojo Ward 8", "Ojo Ward 9", "Ojo Ward 10", "Ojo Ward 11", "Ojo Ward 12"],
    "OSHODI-ISOLO LGA": ["Oshodi-Isolo Ward 1", "Oshodi-Isolo Ward 2", "Oshodi-Isolo Ward 3", "Oshodi-Isolo Ward 4", "Oshodi-Isolo Ward 5", "Oshodi-Isolo Ward 6", "Oshodi-Isolo Ward 7"],
    "SOMOLU LGA": ["Somolu Ward 1", "Somolu Ward 2", "Somolu Ward 3", "Somolu Ward 4", "Somolu Ward 5", "Somolu Ward 6", "Somolu Ward 7", "Somolu Ward 8", "Somolu Ward 9", "Somolu Ward 10"],
    "SURULERE LGA": ["Surulere Ward 1", "Surulere Ward 2", "Surulere Ward 3", "Surulere Ward 4", "Surulere Ward 5", "Surulere Ward 6", "Surulere Ward 7", "Surulere Ward 8", "Surulere Ward 9", "Surulere Ward 10", "Surulere Ward 11"]
};

document.addEventListener('DOMContentLoaded', () => {
    const ownership = document.getElementById('ownership');
    const privateSpecifics = document.getElementById('private-specifics');
    const privateType = document.getElementById('private-type');
    const privateOtherSpecify = document.getElementById('private-other-specify');

    ownership.addEventListener('change', () => {
        if (ownership.value === 'Private') {
            privateSpecifics.style.display = 'block';
        } else {
            privateSpecifics.style.display = 'none';
            privateOtherSpecify.style.display = 'none';
        }
    });

    privateType.addEventListener('change', () => {
        if (privateType.value === 'Others') {
            privateOtherSpecify.style.display = 'block';
        } else {
            privateOtherSpecify.style.display = 'none';
        }
    });

    const lgaSelect = document.getElementById('lga');
    const wardSelect = document.getElementById('ward');

    // Populate LGA dropdown
    for (const lga in lgaWardData) {
        const option = document.createElement('option');
        option.value = lga;
        option.textContent = lga;
        lgaSelect.appendChild(option);
    }

    // Handle LGA change to update Ward dropdown
    lgaSelect.addEventListener('change', () => {
        const selectedLga = lgaSelect.value;
        wardSelect.innerHTML = '<option value="">Select Ward</option>'; // Clear previous options

        if (selectedLga && lgaWardData[selectedLga]) {
            lgaWardData[selectedLga].forEach(ward => {
                const option = document.createElement('option');
                option.value = ward;
                option.textContent = ward;
                wardSelect.appendChild(option);
            });
        }
    });

    const surveyForm = document.getElementById('surveyForm');

    // Auto-calculation logic
    const inputsToCalculate = [
        { male: 'teachersMale', female: 'teachersFemale', total: 'teachersTotal' },
        { male: 'nonTeachingMale', female: 'nonTeachingFemale', total: 'nonTeachingTotal' },
    ];

    inputsToCalculate.forEach(group => {
        const maleInput = document.getElementById(group.male);
        const femaleInput = document.getElementById(group.female);
        const totalInput = document.getElementById(group.total);

        const updateTotal = () => {
            const maleValue = parseInt(maleInput.value) || 0;
            const femaleValue = parseInt(femaleInput.value) || 0;
            totalInput.value = maleValue + femaleValue;
        };

        maleInput.addEventListener('input', updateTotal);
        femaleInput.addEventListener('input', updateTotal);
    });

    function setupTableCalculation(tableId) {
        const table = document.getElementById(tableId);
        if (!table) return;

        const tbody = table.querySelector('tbody');

        const updateRowTotal = (row) => {
            const maleInput = row.querySelector('input[name*="_male"]');
            const femaleInput = row.querySelector('input[name*="_female"]');
            const totalInput = row.querySelector('input[name*="_total"]');

            if (maleInput && femaleInput && totalInput) {
                const maleValue = parseInt(maleInput.value) || 0;
                const femaleValue = parseInt(femaleInput.value) || 0;
                totalInput.value = maleValue + femaleValue;
            }
        };

        tbody.addEventListener('input', (event) => {
            if (event.target.tagName === 'INPUT' && (event.target.name.includes('_male') || event.target.name.includes('_female'))) {
                const row = event.target.closest('tr');
                updateRowTotal(row);
            }
        });

        // Initial calculation for all rows
        tbody.querySelectorAll('tr').forEach(row => {
            updateRowTotal(row);
        });
    }

    const addStaffRowBtn = document.getElementById('addStaffRow');
    if (addStaffRowBtn) {
        let staffRowCounter = 1;
        const staffProfileTableBody = document.getElementById('staffProfileTableBody');

        addStaffRowBtn.addEventListener('click', () => {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" name="staff_name_${staffRowCounter}"></td>
                <td><input type="text" name="staff_qualification_${staffRowCounter}"></td>
                <td><input type="text" name="staff_specialization_${staffRowCounter}"></td>
                <td><input type="number" name="staff_experience_${staffRowCounter}"></td>
                <td><input type="text" name="staff_trcn_${staffRowCounter}"></td>
            `;
            staffProfileTableBody.appendChild(newRow);
            staffRowCounter++;
        });
    }

    setupTableCalculation('prePrimarySchool');
    setupTableCalculation('juniorSecondarySchool');
    setupTableCalculation('seniorSecondarySchool');
    setupTableCalculation('specialLearners');

    const addSpecialLearnerRowBtn = document.getElementById('addSpecialLearnerRow');
    if (addSpecialLearnerRowBtn) {
        let specialLearnerRowCounter = 2;
        const specialLearnersTable = document.getElementById('specialLearners').querySelector('tbody');

        addSpecialLearnerRowBtn.addEventListener('click', () => {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <select name="specialLearners_class_${specialLearnerRowCounter}">
                        <option value="">Select Class</option>
                        <option value="NURSERY 1">NURSERY 1</option>
                        <option value="NURSERY 2">NURSERY 2</option>
                        <option value="KINDERGARTIN">KINDERGARTIN</option>
                        <option value="PRIMARY 1">PRIMARY 1</option>
                        <option value="PRIMARY 2">PRIMARY 2</option>
                        <option value="PRIMARY 3">PRIMARY 3</option>
                        <option value="PRIMARY 4">PRIMARY 4</option>
                        <option value="PRIMARY 5">PRIMARY 5</option>
                        <option value="PRIMARY 6">PRIMARY 6</option>
                        <option value="JSS1">JSS1</option>
                        <option value="JSS2">JSS2</option>
                        <option value="JSS3">JSS3</option>
                        <option value="SSS1">SSS1</option>
                        <option value="SSS2">SSS2</option>
                        <option value="SSS3">SSS3</option>
                    </select>
                </td>
                <td><input type="number" name="specialLearners_male_${specialLearnerRowCounter}"></td>
                <td><input type="number" name="specialLearners_female_${specialLearnerRowCounter}"></td>
                <td><input type="number" name="specialLearners_total_${specialLearnerRowCounter}" readonly></td>
            `;
            specialLearnersTable.appendChild(newRow);
            specialLearnerRowCounter++;
        });
    }


    surveyForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const formData = new FormData(surveyForm);

        fetch('/api/survey', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            console.log('Response status:', response.status);
            return response.json();
        })
        .then(result => {
            // Form successfully submitted, redirecting to home.
            console.log('Success:', result);
            window.location.href = 'index.html?success=true';
        })
        .catch(error => {
            console.error('Fetch Error:', error);
            // alert('There was an error submitting the survey.');
        });
    });

    window.getLocation = () => {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                document.getElementById('latitude').value = position.coords.latitude;
                document.getElementById('longitude').value = position.coords.longitude;
            });
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    };
});
